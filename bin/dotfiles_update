#!/usr/bin/env sh

set -e

cd $DOTFILES

if [ "$(git diff --stat)" != '' ] || [ "$(git current-branch)" != 'main' ]; then
  echo "Invalid $DOTFILES environment, stop update"
  exit 1
fi

git pull origin main

if [ "$1" = '--all' ]; then
  git subrepo pull --all
  git push origin main
fi
